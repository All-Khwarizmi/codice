"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.runServer = void 0;
const watcher_1 = require("./watcher");
const detect_package_manager_1 = require("detect-package-manager");
const find_root_1 = require("@manypkg/find-root");
const _1 = require(".");
const runServer = async (dir, port) => {
    const emailDir = (0, _1.convertToAbsolutePath)(dir);
    const watcherInstance = (0, watcher_1.createWatcherInstance)(emailDir);
    const cwd = await (0, find_root_1.findRoot)(_1.CURRENT_PATH).catch(() => ({
        rootDir: _1.CURRENT_PATH,
    }));
    const packageManager = await (0, detect_package_manager_1.detect)({
        cwd: cwd.rootDir,
    }).catch(() => 'npm');
    await (0, _1.generateEmailsPreview)(emailDir);
    await (0, _1.syncPkg)();
    await (0, _1.installDependencies)(packageManager);
    (0, _1.startDevServer)(packageManager, port);
    (0, watcher_1.watcher)(watcherInstance, emailDir);
};
exports.runServer = runServer;
